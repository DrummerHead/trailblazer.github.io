<h1 id="operationrepresenter">Operation::Representer</h1>

<p>Representer are a concept from Representable and <a href="/gems/roar">Roar</a> and help to parse and render documents, as found in JSON or XML APIs.</p>

<p>Operations usually receive the <code>params</code> hash and pass this to the form’s <code>#validate</code> method. The same works with documents, with the exception that the form needs a representer to deserialize the document.</p>

<p>With <code>Representer</code> included, operations can infer a representer from the contract class. The representer can be further customized in the <code>::representer</code> block.</p>

<pre><code>class Song::Create &lt; Trailblazer::Operation
  include Representer

  contract do
    property :name
    validates :name, presence: true
  end

  representer do
    # inherited :name
    include Roar::JSON::HAL

    link(:self) { song_path(represented.id) }
  end

  def process(params)
    validate(params[:song]) do # params[:song] is a JSON document.
      contract.save
    end
  end
end
</code></pre>

<h2 id="validation">Validation</h2>

<p>You now invoke the operation with a JSON document, not with a hash anymore.</p>

<pre><code>Song::Create.(song: '{"title": "Fury"}')
</code></pre>

<p>In <code>Operation#validate</code>, the incoming <code>params[:song]</code> will now be treated as a document.</p>

<p>The operation’s representer will be passed into the form’s <code>validate</code> and used as the deserializer, as it can read JSON and understands the format’s specific semantics.</p>

<p>After deserialization/population is finished, validation and processing is analogue to a “normal” non-representer operation.</p>

<h2 id="rendering">Rendering</h2>

<p>The <code>Representer</code> module also imports <code>to_json</code>.</p>

<pre><code>Song::Create.(song: '{"title": "Fury"}').to_json
#=&gt; '{"title": "Fury","_links":{"self":"/songs/1"}}'
</code></pre>

<p>In <code>to_json</code>, the operation’s contract will be passed to the representer and rendered using the representer.</p>

<h2 id="composable-interface">Composable Interface</h2>

<p>You can set your own representer class if you don’t want it to be inferred.</p>

<pre><code>class Create &lt; Trailblazer::Operation
  self.representer_class = SongRepresenter
</code></pre>

<h2 id="responder">Responder</h2>

<p>The <code>Operation::Responder</code> module uses <code>Representer</code> and allows using an operation instance directly with Rails responders.</p>
