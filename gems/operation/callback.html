<h2 id="composable-interface">Composable Interface</h2>

<p>Using <code>Operation::callback</code> simply creates a new <code>Disposable::Callback::Group</code> class for you.</p>

<pre><code>class Comment::Create &lt; Trailblazer::Operation
  callback :after_save do
    # this is a Disposable::Callback::Group class.
  end
</code></pre>

<p>Successive calls with the same name will extend the group.</p>

<pre><code>class Comment::Create &lt; Trailblazer::Operation
  callback :after_save do
    on_change :notify!
  end

  callback :after_save do
    on_change :cleanup!
  end
</code></pre>

<p>Dispatching <code>:after_save</code> will now run <code>#notify!</code>, then <code>#cleanup!</code>.</p>

<p>Note that this also works when inheriting callbacks from a parent operation. You can extend it without changing the parentâ€™s callbacks.</p>

<p>If you prefer keeping callbacks in separate classes, you can do so.</p>

<pre><code>class AfterSave &lt; Disposable::Callback::Group
  on_change :notify!
end
</code></pre>

<p>Register it using <code>::callback</code>.</p>

<pre><code>class Comment::Create &lt; Trailblazer::Operation
  callback :after_save, AfterSave
</code></pre>

<p>As always, the callback can be extended locally.</p>

<pre><code>class Comment::Create &lt; Trailblazer::Operation
  callback :after_save, AfterSave do
    on_update :cleanup!
  end
</code></pre>

<p>Since Trailblazer copies the callback group, this will change the callbacks only for this operation.</p>

<h2 id="custom-callbacks">Custom Callbacks</h2>

<p>You can attach any callback object you like to an operation. It will receive the contract in the initializer and has to respond to <code>#call</code>.</p>

<pre><code>class MyCallback
  def initialize(contract)
    @contract = contract
  end

  def call(options) # this is {context: operation} normally.
    User::Mailer.(@contract.email)
  end
end
</code></pre>

<p>Use <code>::callback</code> to register it as a group.</p>

<pre><code>class Comment::Create &lt; Trailblazer::Operation
  callback :after_save, MyCallback
</code></pre>
