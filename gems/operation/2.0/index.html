<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Trailblazer: Operation Overview</title>
<meta name="description" content="Operation Overview - Trailblazer">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="keywords" content=", ">

<!-- style -->
<link rel="shortcut icon" href="/favicon.ico">
<link href="//fonts.googleapis.com/css?family=Open+Sans:300,%20400,700,800%7CRaleway:400,200,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="/css/application.css">

<!-- script -->
<script src="/javascripts/jquery.min.js"></script>
<script src="/javascripts/application.min.js"></script>
<script>
  jQuery(document).ready(function($) {
    $(document).foundation();

    anchors.add("article h2");
    anchors.add("article h3");

    hljs.configure({
      languages: ['ruby', 'haml']
    });

    hljs.initHighlightingOnLoad();

    // $('#code-slider').slick({arrows: true, dots: true});
    $('.carousel').slick({arrows: true, dots: true});
  });
</script>


<meta property="og:title" content="Operation Overview">
<meta property="og:site_name" content="Trailblazer">
<meta property="og:url" content="http://trailblazer.to/gems/operation/2.0/">
<meta property="og:description" content="">
<meta property="og:image" content="http://trailblazer.to/images/go-trailblazer.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@apotonick">
<meta name="twitter:title" content="Operation Overview">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="http://trailblazer.to/images/go-trailblazer.jpg">

  </head>
  <body>

    <div data-sticky-container class="top-navbar">
  <div class="top-bar sticky" data-sticky data-options="marginTop:0;" style="width:100%">
    <div class="top-bar-title">
      <ul class="menu horizontal">
        <li>
          <a href="/"><img style="height: 25px;" src="/images/logo-top.svg"></a>
        </li>
        <li>
        <span data-responsive-toggle="responsive-menu" data-hide-for="medium">
          <button class="menu-icon" type="button" data-toggle></button>
        </span>
        </li>
      </ul>
    </div>

    <div id="responsive-menu">
      <div class="top-bar-right">
        <ul class="dropdown menu     vertical medium-horizontal" data-dropdown-menu>
          <li><a href="/gems/operation/2.0/release_notes.html">TRB 2.O IS COMING!</a></li>
          <li><a href="https://trbpro.herokuapp.com/">PREMIUM SUPPORT <img alt="Premium Support" src="/images/pro-white.png"></a></li>
          <li><a href="/newsletter/">NEWSLETTER</a></li>
          <li><a href="https://gitter.im/trailblazer/chat" onclick="trackOutboundLink('https://gitter.im/trailblazer/chat'); return false;">CHAT</a></li>
          <li><a href="/guides">GUIDES</a></li>
          <li>
            <a href="#">GEMS</a>
            <ul class="menu vertical">
              <li class=""><a href="/gems/cells">CELLS</a></li>
              <li class=""><a href="/gems/operation/index.html">OPERATION</a></li>
              <li class=""><a href="/gems/reform">REFORM</a></li>
              <li class=""><a href="/gems/representable">REPRESENTABLE</a></li>
              <li class=""><a href="/gems/roar">ROAR</a></li>
              <li class=""><a href="/gems/disposable">DISPOSABLE</a></li>
            </ul>
          </li>
          <li>
            <a href="https://leanpub.com/trailblazer" class="button secondary" onclick="trackOutboundLink('https://leanpub.com/trailblazer'); return false;">GET THE BOOK</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>


    <!-- Hero -->
<div class="hero gems-hero operation2-hero">
  <div class="hero-unit">
    <div class="expanded row">
      <div class="columns">
        <h1 id="project_title">
          Operation
        </h1>
      </div>
    </div>
  </div>
</div>


    <div class="expanded row">
      <div class="medium-9 large-10 medium-push-3 large-push-2 columns">
        <article class="operation2-body">

          
            <header id="doc-header">
  <h1 class="doc-page-title">Operation Overview</h1>
  <span class="doc-last-updated"><i class="fa fa-clock-o" aria-hidden="true"></i> Last updated 23 November 2016</span>

  
    <span class="doc-last-updated">
      <i class="fa fa-diamond" aria-hidden="true"></i>
      <a href="https://github.com/trailblazer/trailblazer-operation">operation</a>

      <a href="/gems/operation/2.0/index.html">
      <span class="version">v2.0</span>
      </a>

    
      <a href="/gems/operation/1.1/index.html">
        <span class="version other">v1.1</span>
      </a>
    

    </span>
  

  <hr>

</header>

          

          <div class="row"> <!-- nach doc header -->
            <div class="large-9 columns" id="docs">   <!-- actual docs -->
              <p>The operation’s goal is simple: Remove all business logic from the controller and model and instead provide a separate object for it. While doing so, this logic is streamlined into the following steps.</p>

<p>The generic logic can be found in the trailblazer-operation gem. Higher-level abstractions, such as form object or policy integration is implemented in the trailblazer gem.</p>

<ul>
  <li>Overview</li>
  <li>Flow Control</li>
  <li>Papi::Operation extend Contract::DSL</li>
</ul>

<hr>

<p>An operation is a Ruby object that embraces all logic needed to implement one function, or <em>use case</em>, of your application. It does so by orchestrating various objects like form objects for validations, models for persistence or callbacks to implement post-processing logic.</p>

<p>While you could do all that in a nested, procedural way, the Trailblazer operation uses a pipetree to structure the control flow and error handling.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>class Create &lt; Trailblazer::Operation
end
</code></pre>
</div>

<h2 id="invocation" data-magellan-target="invocation">Invocation</h2>

<p>An operation is designed like a function and it can only be invoked in one way: via <code class="highlighter-rouge">Operation::call</code>.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>Create.call( name: "Roxanne" )
</code></pre>
</div>

<p>Ruby allows a shorthand for this which is commonly used throughout Trailblazer.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>Create.( name: "Roxanne" )
</code></pre>
</div>

<p>The absence of a method name here is per design: this object does only one thing, has only one public method, and hence <strong>what is does is reflected in the class name</strong>. Likewise, you never instantiate operations manually - this contradicts its functional concept and prevents you from randomly running methods on it in the wrong order.</p>

<p>Running an operation will always return a result object. It is up to you to interpret the content of it or push data onto the result object during the operation’s cycle.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>result = Create.call( name: "Roxanne" )
</code></pre>
</div>

<p><a href="#result-object">→ Result object</a></p>

<h2 id="flow-control-procedural" data-magellan-target="flow-control-procedural">Flow Control: Procedural</h2>

<p>There’s nothing wrong with implementing your operation’s logic in a procedural, nested stack of method calls, the way Trailblazer 1.x worked. The behavior here was orchestrated from within the <code class="highlighter-rouge">process</code> method.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>class Create &lt; Trailblazer::Operation
  self.&gt; Process

  def process(params)
    model = Song.new

    if validate(params)
      unless contract.save
        handle_persistence_errors!
      end
      after_save!
    else
      handle_errors!
    end
  end
end
</code></pre>
</div>

<p>Even though this might seem to be more “readable” at first glance, it is impossible to extend without breaking the code up into smaller methods that are getting called in a predefined order - sacrificing its aforementioned readability.</p>

<p>Also, error handling needs to be done manually at every step. This is the price you pay for procedural, statically nested code.</p>

<h2 id="flow-control-pipetree" data-magellan-target="flow-control-pipetree">Flow Control: Pipetree</h2>

<p>You can also use TRB2’s new <em>pipetree</em>. Instead of nesting code statically, the code gets added sequentially to a pipeline in a functional style. This pipeline is processed top-to-bottom when the operation is run.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>class Create &lt; Trailblazer::Operation
  self.&gt; :model!
  self.&gt; :validate!
  self.&gt; :persist!

  def model!(options)
    Song.new
  end
  # ...
end
</code></pre>
</div>

<p>Logic can be added using the <code class="highlighter-rouge">Operation::&gt;</code> operator. The logic you add is called <em>step</em> and can be <a href="api.html">an instance method, a callable object or a proc</a>.</p>

<p>Under normal conditions, those steps are simply processed in the specified order. Imagine that as a track of tasks. The track we just created, with steps being applied when things go right, is called the <em>right track</em>.</p>

<p>The operation also has a <em>left track</em> for error handling. Steps on the right side can deviate to the left track and remaining code on the right track will be skipped.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>class Create &lt; Trailblazer::Operation
  self.&gt; :model!
  self.&gt; :validate!
  self.&lt; :validate_error!
  self.&gt; :persist!
  self.&lt; :persist_error!
  # ...
end
</code></pre>
</div>

<p>Adding steps to the left track happens via the <code class="highlighter-rouge">Operation::&lt;</code> operator.</p>

<h2 id="pipetree-visualization" data-magellan-target="pipetree-visualization">Pipetree Visualization</h2>

<p>Visualizing the pipetree you just created makes is very obvious what is going to happen when you run this operation. Note that you can render any operation’s pipetree anywhere in your code for a better understanding.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>Create["pipetree"].inspect

 0 =======================&gt;&gt;operation.new
 1 ===============================&gt;:model
 2 ============================&gt;:validate
 3 &lt;:validate_error!=====================
 4 ============================&gt;:persist!
 5 &lt;:persist_error!======================
</code></pre>
</div>

<p>Once deviated to the left track, the pipetree processing will skip any steps remaining on the right track. For example, should <code class="highlighter-rouge">validate!</code> deviate, the <code class="highlighter-rouge">persist!</code> step is never executed (unless you want that).</p>

<p>Now, how does a step make the pipetree change tracks, e.g. when there’s a validation error?</p>

<h2 id="track-deviation" data-magellan-target="track-deviation">Track Deviation</h2>

<p>The easiest way for changing tracks is letting the pipetree interpret the return value of a step. This is accomplished with the <code class="highlighter-rouge">Operation::&amp;</code> operator.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>class Create &lt; Trailblazer::Operation
  self.&gt; :model!
  self.&amp; :validate!
  self.&lt; :validate_error!
  # ...
end
</code></pre>
</div>

<p>Should the <code class="highlighter-rouge">validate!</code> step return a falsey value, the pipetree will change tracks to the left.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>class Create &lt; Trailblazer::Operation
  # ...
  def validate!(*)
    self["params"].has_key?(:title) # returns true of false.
  end
end
</code></pre>
</div>

<p>Check the <a href="pipetree.html">API docs for pipetree</a> to learn more about tracks.</p>

<h2 id="step-macros" data-magellan-target="step-macros">Step Macros</h2>

<p>Trailblazer provides predefined steps to for all kinds of business logic.</p>

<ul>
  <li>
<a href="contract.html">Contract</a> implements contracts, validation and persisting verified data using the model layer.</li>
</ul>

<h2 id="orchestration" data-magellan-target="orchestration">Orchestration</h2>

<h2 id="result-object" data-magellan-target="result-object">Result Object</h2>

<p>result.contract [.errors, .success?, failure?]
result.policy [, .success?, failure?]</p>

            </div>

            <div class="large-3 columns sticky-container" data-sticky-container>

              
                <nav class="sticky columns docs-toc-wrap sticky is-anchored is-at-top side-nav" data-sticky data-anchor="docs" data-sticky-on="large" data-margin-top="5">
  
        <ul class="vertical menu" data-magellan id="page-toc">
          <li class="page-toc-heading">ON THIS PAGE:</li>
          <li><a href="#invocation">Invocation</a></li>
<li><a href="#flow-control-procedural">Flow Control: Procedural</a></li>
<li><a href="#flow-control-pipetree">Flow Control: Pipetree</a></li>
<li><a href="#pipetree-visualization">Pipetree Visualization</a></li>
<li><a href="#track-deviation">Track Deviation</a></li>
<li><a href="#step-macros">Step Macros</a></li>
<li><a href="#orchestration">Orchestration</a></li>
<li><a href="#result-object">Result Object</a></li>
        </ul>
      
</nav>

              

            </div>
          </div>
        </article>
      </div>

      <div class="medium-3 large-2 medium-pull-9 large-pull-10 columns">
        <ul class="vertical menu side-nav">
    <li class="heading">
        <a href="/gems/operation/index.html">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> OPERATION
        </a>
    </li>
    <li><a href="/gems/operation/api.html">API</a></li>
    <li><a href="/gems/operation/contract.html">Contract</a></li>
    <li><a href="/gems/operation/builder.html">Builder</a></li>
    <li><a href="/gems/operation/collection.html">Collection</a></li>
    <li><a href="/gems/operation/callback.html">Callback</a></li>
    <li><a href="/gems/operation/controller.html">Controller</a></li>
    <li><a href="/gems/operation/representer.html">Representer</a></li>
    <li><a href="/gems/operation/model.html">Model</a></li>
    <li><a href="/gems/operation/policy.html">Policy</a></li>
    <li><a href="/gems/operation/2.0/pipetree.html">Pipetree</a></li>
    <li><a href="/gems/operation/2.0/endpoint.html">Endpoint</a></li>
    <li class="divider">

    <li class="heading">
        <a href="/gems/cells">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> CELLS
        </a>
    </li>
    <li><a href="/gems/cells/getting-started.html">Getting Started<span class="sidebar-info">NEW</span></a></li>
    <li><a href="/gems/cells/api.html">API</a></li>
    <li><a href="/gems/cells/trailblazer.html">Trailblazer::Cell</a></li>
    <li><a href="/gems/cells/testing.html">Testing</a></li>
    <li><a href="/gems/cells/render.html">Rendering</a></li>
    <li><a href="/gems/cells/rails.html">Rails</a></li>
    <li><a href="/gems/cells/templates.html">Templates</a></li>
    <li><a href="/gems/cells/troubleshooting.html">Troubleshooting</a></li>
    <li class="divider">

    <li class="heading">
        <a href="/gems/reform">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> REFORM
        </a>
    </li>
    <li><a href="/gems/reform/api.html">API</a></li>
    <li><a href="/gems/reform/options.html">Options</a></li>
    <li><a href="/gems/reform/data-types.html">Data Types</a></li>
    <li><a href="/gems/reform/populator.html">Populator</a></li>
    <li><a href="/gems/reform/prepopulator.html">Prepopulator</a></li>
    <li><a href="/gems/reform/validation.html">Validation</a></li>
    <li><a href="/gems/reform/rails.html">Rails</a></li>
    <li><a href="/gems/reform/debugging.html">Debugging</a></li>
    <li><a href="/gems/reform/upgrading-guide.html">Upgrading Guide</a></li>
    <li class="divider">

    <li class="heading">
        <a href="/gems/representable">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> REPRESENTABLE
        </a>
    </li>
    <li><a href="/gems/representable/getting-started.html">Getting Started</a></li>
    <li><a href="/gems/representable/3.0/api.html">API</a></li>
    <li><a href="/gems/representable/3.0/function-api.html">Function API</a></li>
    <li><a href="/gems/representable/3.0/populator.html">Populator</a></li>
    <!-- <li><a href="/gems/representable/architecture.html">Architecture</a></li> -->
    <li><a href="/gems/representable/3.0/xml.html">XML</a></li>
    <li><a href="/gems/representable/3.0/yaml.html">YAML</a></li>
    <li><a href="/gems/representable/upgrading-guide.html">Upgrading Guide</a></li>
    <li class="divider">

    <li class="heading">
        <a href="/gems/roar">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> ROAR
        </a>
    </li>
    <li><a href="/gems/roar/jsonapi.html">JSON API</a></li>
    <li class="divider">

    <li class="heading">
        <a href="/gems/disposable">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> DISPOSABLE
        </a>
    </li>
    <li><a href="/gems/disposable/api.html">API</a></li>
    <li><a href="/gems/disposable/default.html">Default</a></li>
    <li><a href="/gems/disposable/callback.html">Callback</a></li>
    <li class="divider">

    <li class="heading">
        <a href="/guides">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> GUIDES
        </a>
    </li>
    <li><a href="/guides/trailblazer-in-20-minutes.html">Trailblazer In 20 Minutes</a></li>
    <li><a href="/guides/getting-started.html">Getting Started</a></li>
    <li><a href="/guides/sinatra/getting-started.html">Sinatra</a></li>
    <li><a href="/guides/grape.html">Grape</a></li>
</ul>

      </div>
    </div>


    <section class="top-footer">
  <div class="row">
    <div class="columns medium-6">
      <h3>Newsletter</h3>
      <p>
        Stay on top of what’s happening in Trailblazer.
      </p>
        <div class="row">
          <div id="mc_embed_signup">
            <form action="//trailblazerb.us8.list-manage.com/subscribe/post?u=bbe5021ab6fbdc94a16f0d036&amp;id=a69f6e4652" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>

              <div class="columns large-9 medium-12 ">
                <div class="row collapse prefix-radius">
                  <div class="small-8 medium-7 large-8 columns">
                    <div id="mc_embed_signup_scroll">
                      <div class="mc-field-group">
                        <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="youremail@trailblazer.to">
                      </div>
                      <div id="mce-responses" class="clear">
                        <div class="response" id="mce-error-response" style="display:none"></div>
                        <div class="response" id="mce-success-response" style="display:none"></div>
                      </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_bbe5021ab6fbdc94a16f0d036_a69f6e4652" tabindex="-1" value=""></div>

                    </div>
                  </div>
                  <div class="small-4 medium-5 large-4 columns">
                    <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button postfix secondary">
                  </div>
                </div>
              </div>
            </form>
          </div>
          <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
        </div>
      <p>
        And check out the <a href="/newsletter/">archive of newsletters</a>!
      </p>


    </div>
    <div class="columns medium-6">
      <h3>The Book</h3>
      <p>Learn how to build a Rails app with Trailblazer, step-by-step.</p>
      <a href="https://leanpub.com/trailblazer" class="button secondary">Get the book!</a>
    </div>
  </div>
</section>

<footer>
  <div class="row">
    <div class="columns medium-4">
      <div class="logo-box">
        <a href="/"><img src="/images/icon_trb.png">
        </a>
      </div>
    </div>
    <div class="columns medium-8">
      <div class="row">
        <div class="columns medium-6">
          <h4>
            Trailblazer
          </h4>
          <ul class="no-bullet">
            <li><a href="https://gitter.im/trailblazer/chat">Gitter chat</a></li>
            <li><a href="https://leanpub.com/trailblazer" onclick="trackOutboundLink('https://leanpub.com/trailblazer'); return false;">The book</a></li>
          </ul>
        </div>
        <div class="columns medium-6">
          <h4>
            Follow Us
          </h4>
          <ul class="menu">
            <li>
              <a href="https://github.com/trailblazer">
                <i class="footer-icon github-icon"></i>
              </a>
            </li>
            <li>
              <a href="https://twitter.com/apotonick">
                <i class="footer-icon twitter-icon"></i>
              </a>
            </li>
            <li>
              <a href="https://facebook.com/trbinc">
                <i class="footer-icon facebook-icon"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <p class="copyright">
        Trailblazer is created by <a href="http://www.synergysoft.com.sg/">Synergy Software Solutions Pte Ltd,</a> and awesome friends.
      </p>
      <p class="copyright">
        Site designed and handcoded with love by <a href="https://twitter.com/noeliacabane">Noelia Cabane</a>
      </p>
    </div>
  </div>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69514939-1', 'auto');
  ga('send', 'pageview');

  /**
  * Function that tracks a click on an outbound link in Analytics.
  * This function takes a valid URL string as an argument, and uses that URL string
  * as the event label. Setting the transport method to 'beacon' lets the hit be sent
  * using 'navigator.sendBeacon' in browser that support it.
  */
  var trackOutboundLink = function(url) {
     ga('send', 'event', 'outbound', 'click', url, {
       'transport': 'beacon',
       'hitCallback': function(){document.location = url;}
     });
  }
</script>



  </body>
</html>
