<!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Trailblazer: Cells API</title>
<meta name="description" content="Cells API - Trailblazer" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="keywords" content=", " />

<link href="//fonts.googleapis.com/css?family=Open+Sans:300, 400,700,800|Raleway:400,200,700" rel="stylesheet" type="text/css">

<link rel="stylesheet" href="/css/style.css" />
<link rel="shortcut icon" href="favicon.ico">

<script src="/js/foundation.js"></script>
<link rel="stylesheet" href="/css/dark.css">
<script src="/javascripts/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="/bower_components/modernizr/modernizr.js"></script>

<meta property="og:title" content="Cells API"/>
<meta property="og:site_name" content="Trailblazer"/>
<meta property="og:url" content="http://trailblazer.to"/>
<meta property="og:description" content=""/>
<meta property="og:image" content="http://trailblazer.to/images/go-trailblazer.jpg"/>
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@apotonick">
<meta name="twitter:title" content="Cells API">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="http://trailblazer.to/images/go-trailblazer.jpg">
  </head>

  <body class="cells-body">
    <!-- Top Bar -->
    <nav class="top-bar" data-topbar role="navigation">
  <ul class="title-area">
    <li class="name">
      <h1><a href="/"><img style="height: 25px;" src="/images/logo-top.svg"></a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
  </ul>

  <section class="top-bar-section">
    <ul class="right">
    <li><a href="https://gitter.im/trailblazer/chat">Support chat</a></li>
    <li class="divider"></li>
      <li class="has-dropdown">
        <a href="#">Gems</a>
        <ul class="dropdown">
          <li class=""><a href="/gems/cells">Cells</a></li>
          <li class=""><a href="/gems/operation">Operation</a></li>
          <li class=""><a href="/gems/reform">Reform</a></li>
          <li class=""><a href="/gems/representable">Representable</a></li>
          <li class=""><a href="/gems/roar">Roar</a></li>
          <li class=""><a href="/gems/disposable">Disposable</a></li>
        </ul>
      </li>
      <li class="divider"></li>
      <li class="has-form">
        <a href="https://leanpub.com/trailblazer" class="button radius secondary">Get the book</a>
      </li>     
    </ul>
  </section>
</nav>


    <!-- Hero -->
    <div class="hero gems-hero cells-hero">
      <div class="hero-unit">
        <div class="row">
          <div class="columns">
            <h1 id="project_title">
              Cells
            </h1>
          </div>
        </div>
      </div>
    </div>



    <div class="row">
      <div class="columns large-3 sidebar">
        <nav>
  <ul class="side-nav">

    <li class="heading"><a href="/gems/operation">operation</a></li>
    <li><a href="/gems/operation/api.html">API</a></li>
    <li><a href="/gems/operation/builder.html">Builder</a></li>
    <li><a href="/gems/operation/collection.html">Collection</a></li>
    <li><a href="/gems/operation/callback.html">Callback</a></li>
    <li><a href="/gems/operation/controller.html">Controller</a></li>
    <li><a href="/gems/operation/representer.html">Representer</a></li>
    <li><a href="/gems/operation/model.html">Model</a></li>
    <li><a href="/gems/operation/policy.html">Policy</a></li>
    <li class="divider"></li>

    <li class="heading"><a href="/gems/cells">cells</a></li>
    <li><a href="/gems/cells/api.html">API</a></li>
    <li><a href="/gems/cells/testing.html">Testing</a></li>
    <li><a href="/gems/cells/render.html">Rendering</a></li>
    <li><a href="/gems/cells/rails.html">Rails</a></li>
    <li><a href="/gems/cells/helpers.html">Helpers</a></li>
    <li><a href="/gems/cells/templates.html">Templates</a></li>
    <li><a href="/gems/cells/troubleshooting.html">Troubleshooting</a></li>
    <li class="divider"></li>

    <li class="heading"><a href="/gems/reform">Reform</a></li>
    <li><a href="/gems/reform/populator.html">Populator</a></li>
    <li><a href="/gems/reform/nested_forms.html">Nested Forms</a></li>
    <li><a href="/gems/reform/prepopulator.html">Prepopulator</a></li>
    <li><a href="/gems/reform/validation.html">Validation</a></li>
    <li><a href="/gems/reform/debugging.html">Debugging</a></li>
    <li><a href="/gems/reform/rails.html">Rails</a></li>
    <li><a href="/gems/reform/upgrading-guide.html">Upgrading Guide</a></li>
    <li class="divider"></li>

    <li class="heading"><a href="/gems/representable">Representable</a></li>
    <li><a href="/gems/representable/getting-started.html">Getting Started</a></li>
    <li><a href="/gems/representable/3.0/api.html">API</a></li>
    <li><a href="/gems/representable/3.0/function-api.html">Function API</a></li>
    <li><a href="/gems/representable/3.0/populator.html">Populator</a></li>
    <!-- <li><a href="/gems/representable/architecture.html">Architecture</a></li> -->
    <li><a href="/gems/representable/3.0/xml.html">XML</a></li>
    <li><a href="/gems/representable/3.0/yaml.html">YAML</a></li>
    <li><a href="/gems/representable/upgrading-guide.html">Upgrading Guide</a></li>
    <li class="divider"></li>

    <li class="heading"><a href="/gems/roar/">Roar</a></li>
    <li><a href="/gems/roar/jsonapi.html">JSON API</a></li>
    <li class="divider"></li>

    <li class="heading"><a href="/gems/disposable/">Disposable</a></li>
    <li><a href="/gems/disposable/api.html">API</a></li>
    <li><a href="/gems/disposable/default.html">Default</a></li>
    <li><a href="/gems/disposable/callback.html">Callback</a></li>
    <li class="divider"></li>

    <li class="heading"><a href="/gems/guides/">Guides</a></li>
    <li><a href="/guides/sinatra/getting-started.html">Sinatra: Getting Started</a></li>
  </ul>
</nav>

      </div>
      <div class="columns medium-9 code-content">
        <h2 id="cell-class">Cell Class</h2>

<p>Every fragment is represented by a cell class. Following the Trailblazer convention, the <code>Comment::Cell</code> sits in <code>app/concepts/comment/cell.rb</code>.</p>

<pre><code class="language-ruby">class Comment::Cell &lt; Cell::ViewModel
  def show
    render # renders app/concepts/comment/view[s]/show.haml.
  end
end
</code></pre>

<p>A cell has to define at least one method which in turn has to return the fragment. Per convention, this is <code>show</code>. In the public method, you may compile arbitrary strings or <code>render</code> a cell view.</p>

<p>The return value of this public method (also called <em>state</em>) is what will be the rendered in the view using the cell.</p>

<h2 id="manual-invocation">Manual Invocation</h2>

<p>Without using any helpers and in its purest form, a cell can be rendered as follows.</p>

<pre><code class="language-ruby">Comment::Cell.new(comment).(:show) #=&gt; "fragment string"
</code></pre>

<p>This can be split up into two steps: initialization and invocation.</p>

<h2 id="initialize">Initialize</h2>

<p>While you will mostly use the <code>concept</code> or <code>cell</code> helper in views and controllers, you may instantiate cells manually.</p>

<pre><code class="language-ruby">cell = Comment::Cell.new(comment)
</code></pre>

<p>This is helpful in environments where the helpers are not available, e.g. a Rails mailer or a <code>Lotus::Action</code>.</p>

<p>You can also pass arbitrary options into the cell, for example the controller.</p>

<pre><code class="language-ruby">cell = Comment::Cell.new(comment, parent_controller: self)
</code></pre>

<p>However, in most cases you instantiate cells with the <code>concept</code> or <code>cell</code> helper which internally does exactly the same.</p>

<pre><code>cell = concept("comment/cell", comment)
</code></pre>

<p>As always in Ruby, instantiation returns the cell instance.</p>

<h2 id="invocation">Invocation</h2>

<p>Once you got the cell instance, you may call the rendering state.</p>

<pre><code>cell.(:show)
</code></pre>

<p>Since <code>show</code> is the default state, you may simple <em>call</em> the cell without arguments.</p>

<pre><code>cell.() #=&gt; cell.(:show)
</code></pre>

<p>Note that in Rails controller views, this will be called automatically via cell’s <code>ViewModel#to_s</code> method.</p>

<h2 id="call">Call</h2>

<p>Always invoke cell methods via <code>call</code>. This will ensure that caching - if configured - is performed properly.</p>

<pre><code>concept("comment/cell", comment).(:show)
</code></pre>

<p>This will call the cell’s <code>show</code> method and return the rendered fragment.</p>

<p>Note that you can invoke more than one state on a cell, if desired.</p>

<pre><code class="language-ruby">- cell = concept("comment/cell", Song.last) # instantiate.
= cell.call(:show)                          # render main fragment.
= content_for :footer, cell.(:footer)       # render footer.
</code></pre>

<p>See how you can combine cells with global helpers like <code>content_for</code>?</p>

<h2 id="options">Options</h2>

<p>A cell can wrap more than one model. This can be handy to pass in additional data you need for presentation.</p>

<pre><code>concept("comment/cell", comment, admin: true)
</code></pre>

<p>Inside the cell, the additional options are available via <code>#options</code>.</p>

<pre><code>class Comment::Cell &lt; Cell::ViewModel
  def show
    return render :admin if options[:admin]
    render
  end
</code></pre>

<p>Class.()</p>

<p>Class.build (no def args)</p>

<p>ViewModel::cell()</p>

<h2 id="html-escaping">HTML Escaping</h2>

<p>Cells per default does no HTML escaping, anywhere. This is one of the reasons that makes Cells faster than Rails.</p>

<p>Include <code>Escaped</code> to make property readers return escaped strings.</p>

<pre><code>class CommentCell &lt; Cell::ViewModel
  include Escaped
  property :title
end

song.title                 #=&gt; "&lt;script&gt;Dangerous&lt;/script&gt;"
Comment::Cell.(song).title #=&gt; &amp;lt;script&amp;gt;Dangerous&amp;lt;/script&amp;gt;
</code></pre>

<p>Only strings will be escaped via the property reader.</p>

<p>You can suppress escaping manually.</p>

<pre><code>def raw_title
  "#{title(escape: false)} on the edge!"
end
</code></pre>

<p>Of course, this works in views, too.</p>

<pre><code>&lt;%= title(escape: false) %&gt;
</code></pre>

<h2 id="nesting">Nesting</h2>

<h2 id="view-inheritance">View Inheritance</h2>

<p>Cells can inherit code from each other with Ruby’s inheritance.</p>

<pre><code class="language-ruby">class CommentCell &lt; Cell::ViewModel
end

class PostCell &lt; CommentCell
end
</code></pre>

<p>Even cooler, <code>PostCell</code> will now inherit views from <code>CommentCell</code>.</p>

<pre><code class="language-ruby">PostCell.prefixes #=&gt; ["app/cells/post", "app/cells/comment"]
</code></pre>

<p>When views can be found in the local <code>post</code> directory, they will be looked up in <code>comment</code>. This starts to become helpful when using <a href="#nested-cells">composed cells</a>.</p>

<p>If you only want to inherit views, not the entire class, use <code>::inherit_views</code>.</p>

<pre><code class="language-ruby">class PostCell &lt; Cell::ViewModel
  inherit_views Comment::Cell
end

PostCell.prefixes #=&gt; ["app/cells/post", "app/cells/comment"]
</code></pre>

<h1 id="collections">Collections</h1>

<p>This will instantiate each collection cell as follows.</p>

<pre><code>Comment.(comment, style: "awesome", volume: "loud")
</code></pre>

<h2 id="caching">Caching</h2>

<p>Cells allow you to cache per state. It’s simple: the rendered result of a state method is cached and expired as you configure it.</p>

<p>To cache forever, don’t configure anything</p>

<pre><code class="language-ruby">class CartCell &lt; Cell::Rails
  cache :show

  def show
    render
  end
</code></pre>

<p>This will run <code>#show</code> only once, after that the rendered view comes from the cache.</p>

<h2 id="cache-options">Cache Options</h2>

<p>Note that you can pass arbitrary options through to your cache store. Symbols are evaluated as instance methods, callable objects (e.g. lambdas) are evaluated in the cell instance context allowing you to call instance methods and access instance variables. All arguments passed to your state (e.g. via <code>render_cell</code>) are propagated to the block.</p>

<pre><code class="language-ruby">cache :show, :expires_in =&gt; 10.minutes
</code></pre>

<p>If you need dynamic options evaluated at render-time, use a lambda.</p>

<pre><code class="language-ruby">cache :show, :tags =&gt; lambda { |*args| tags }
</code></pre>

<p>If you don’t like blocks, use instance methods instead.</p>

<pre><code class="language-ruby">class CartCell &lt; Cell::Rails
  cache :show, :tags =&gt; :cache_tags

  def cache_tags(*args)
    # do your magic..
  end
</code></pre>

<h2 id="conditional-caching">Conditional Caching</h2>

<p>The <code>:if</code> option lets you define a condition. If it doesn’t return a true value, caching for that state is skipped.</p>

<pre><code class="language-ruby">cache :show, :if =&gt; lambda { |*| has_changed? }
</code></pre>

<h2 id="cache-keys">Cache Keys</h2>

<p>You can expand the state’s cache key by appending a versioner block to the <code>::cache</code> call. This way you can expire state caches yourself.</p>

<pre><code class="language-ruby">class CartCell &lt; Cell::Rails
  cache :show do |options|
    order.id
  end
</code></pre>

<p>The versioner block is executed in the cell instance context, allowing you to access all stakeholder objects you need to compute a cache key. The return value is appended to the state key: <code>"cells/cart/show/1"</code>.</p>

<p>As everywhere in Rails, you can also return an array.</p>

<pre><code class="language-ruby">class CartCell &lt; Cell::Rails
  cache :show do |options|
    [id, options[:items].md5]
  end
</code></pre>

<p>Resulting in: <code>"cells/cart/show/1/0ecb1360644ce665a4ef"</code>.</p>

<h2 id="debugging-cache">Debugging Cache</h2>

<p>When caching is turned on, you might wanna see notifications. Just like a controller, Cells gives you the following notifications.</p>

<ul>
  <li><code>write_fragment.action_controller</code> for cache miss.</li>
  <li><code>read_fragment.action_controller</code> for cache hits.</li>
</ul>

<p>To activate notifications, include the <code>Notifications</code> module in your cell.</p>

<pre><code class="language-ruby">class Comment::Cell &lt; Cell::Rails
  include Cell::Caching::Notifications
</code></pre>

<h2 id="cache-inheritance">Cache Inheritance</h2>

<p>Cache configuration is inherited to derived cells.</p>

<h2 id="testing-caching">Testing Caching</h2>

<p>If you want to test it in <code>development</code>, you need to put <code>config.action_controller.perform_caching = true</code> in <code>development.rb</code> to see the effect.</p>


      </div>
    </div>

    <!-- Footer -->
    <footer>
  <div class="row">
    <div class="columns medium-4">
      <div class="logo-box">
        <a href="/"><img src="/images/icon_trb.png">
        </a>
      </div>
    </div>
    <div class="columns medium-8">
      <div class="row">
        <div class="columns medium-6">
          <h4>
            Trailblazer
          </h4>
          <ul class="no-bullet">
            <li><a href="https://gitter.im/trailblazer/chat">Gitter chat</a></li>
            <li><a href="https://leanpub.com/trailblazer">The book</a></li>
          </ul>
        </div>
        <div class="columns medium-6">
          <h4>
            Follow Us
          </h4>
          <ul class="inline-list">
            <li>
              <a href="https://github.com/trailblazer">
                <i class="footer-icon github-icon"></i>
              </a>
            </li>
            <li>
              <a href="https://twitter.com/apotonick">
                <i class="footer-icon twitter-icon"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <p class="copyright">
        Trailblazer is created by <a href="https://github.com/apotonick">Nick Sutterer</a> and awesome friends.
      </p>
      <p class="copyright">
        Site designed and handcoded with love by <a href="https://twitter.com/noeliacabane">Noelia Cabane</a>
      </p>
    </div>
  </div>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69514939-1', 'auto');
  ga('send', 'pageview');

</script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/bower_components/jquery/jquery.js"><\/script>')</script>
<script src="/javascripts/plugins.js"></script>
<script src="/bower_components/foundation/js/foundation.min.js"></script>
<script src="/javascripts/script.js"></script>

  </body>
</html>
