<!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Trailblazer: Reform Prepopulators</title>
<meta name="description" content="Reform Prepopulators - Trailblazer" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="keywords" content=", " />

<link href="//fonts.googleapis.com/css?family=Open+Sans:300, 400,700,800|Raleway:400,200,700" rel="stylesheet" type="text/css">

<link rel="stylesheet" href="/css/style.css" />
<link rel="shortcut icon" href="/favicon.ico">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

<meta property="og:title" content="Reform Prepopulators"/>
<meta property="og:site_name" content="Trailblazer"/>
<meta property="og:url" content="http://trailblazer.to/gems/reform/prepopulator.html"/>
<meta property="og:description" content=""/>
<meta property="og:image" content="http://trailblazer.to/images/go-trailblazer.jpg"/>
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@apotonick">
<meta name="twitter:title" content="Reform Prepopulators">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="http://trailblazer.to/images/go-trailblazer.jpg">

<script src="/javascripts/jquery.min.js"></script>
<script src="/javascripts/application.min.js"></script>

<script>
  anchors.add(".code-content h2, .sub-section h2");

  hljs.initHighlightingOnLoad();

  $(document).foundation();
</script>



  </head>

  <body class="reform-body">

      <nav class="top-bar" data-topbar role="navigation">
  <ul class="title-area">
    <li class="name">
      <h1><a href="/"><img style="height: 25px;" src="/images/logo-top.svg"></a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
  </ul>

  <section class="top-bar-section">
    <ul class="right">
    <li id="nav-pro">
      <a href="https://trbpro.herokuapp.com/">PREMIUM SUPPORT <img alt="Premium Support" src="/images/pro-white.png"></a>
    </li>
    <li class="divider"></li>
    <li><a href="/newsletter/">NEWSLETTER</a></li>
    <li class="divider"></li>
    <li><a href="https://gitter.im/trailblazer/chat">CHAT</a></li>
    <li class="divider"></li>
    <li><a href="/users.html">USERS</a></li>
    <li class="divider"></li>
    <li><a href="/guides">GUIDES</a></li>
    <li class="divider"></li>
      <li class="has-dropdown">
        <a href="#">GEMS</a>
        <ul class="dropdown">
          <li class=""><a href="/gems/cells">CELLS</a></li>
          <li class=""><a href="/gems/operation">OPERATION</a></li>
          <li class=""><a href="/gems/reform">REFORM</a></li>
          <li class=""><a href="/gems/representable">REPRESENTABLE</a></li>
          <li class=""><a href="/gems/roar">ROAR</a></li>
          <li class=""><a href="/gems/disposable">DISPOSABLE</a></li>
        </ul>
      </li>
      <li class="divider"></li>
      <li class="has-form">
        <a href="https://leanpub.com/trailblazer" class="button radius secondary">GET THE BOOK</a>
      </li>
    </ul>
  </section>
</nav>


    <!-- Hero -->
    <div class="hero gems-hero reform-hero">
      <div class="hero-unit">
        <div class="row">
          <div class="columns">
            <h1>
              Reform
            </h1>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="columns large-3 sidebar">
        <nav>
  <ul class="side-nav">

    <li class="heading">
        <a href="/gems/operation">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> OPERATION
        </a>
    </li>
    <li><a href="/gems/operation/api.html">API</a></li>
    <li><a href="/gems/operation/contract.html">Contract</a></li>
    <li><a href="/gems/operation/builder.html">Builder</a></li>
    <li><a href="/gems/operation/collection.html">Collection</a></li>
    <li><a href="/gems/operation/callback.html">Callback</a></li>
    <li><a href="/gems/operation/controller.html">Controller</a></li>
    <li><a href="/gems/operation/representer.html">Representer</a></li>
    <li><a href="/gems/operation/model.html">Model</a></li>
    <li><a href="/gems/operation/policy.html">Policy</a></li>
    <li class="divider"></li>

    <li class="heading">
        <a href="/gems/cells">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> CELLS
        </a>
    </li>
    <li><a href="/gems/cells/getting-started.html">Getting Started</a></li>
    <li><a href="/gems/cells/api.html">API</a></li>
    <li><a href="/gems/cells/trailblazer.html">Trailblazer::Cell</a></li>
    <li><a href="/gems/cells/testing.html">Testing</a></li>
    <li><a href="/gems/cells/render.html">Rendering</a></li>
    <li><a href="/gems/cells/rails.html">Rails</a></li>
    <li><a href="/gems/cells/templates.html">Templates</a></li>
    <li><a href="/gems/cells/troubleshooting.html">Troubleshooting</a></li>
    <li class="divider"></li>

    <li class="heading">
        <a href="/gems/reform">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> REFORM
        </a>
    </li>
    <li><a href="/gems/reform/api.html">API</a></li>
    <li><a href="/gems/reform/populator.html">Populator</a></li>
    <li><a href="/gems/reform/nested_forms.html">Nested Forms</a></li>
    <li><a href="/gems/reform/prepopulator.html">Prepopulator</a></li>
    <li><a href="/gems/reform/validation.html">Validation</a></li>
    <li><a href="/gems/reform/debugging.html">Debugging</a></li>
    <li><a href="/gems/reform/upgrading-guide.html">Upgrading Guide</a></li>
    <li class="divider"></li>

    <li class="heading">
        <a href="/gems/representable">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> REPRESENTABLE
        </a>
    </li>
    <li><a href="/gems/representable/getting-started.html">Getting Started</a></li>
    <li><a href="/gems/representable/3.0/api.html">API</a></li>
    <li><a href="/gems/representable/3.0/function-api.html">Function API</a></li>
    <li><a href="/gems/representable/3.0/populator.html">Populator</a></li>
    <!-- <li><a href="/gems/representable/architecture.html">Architecture</a></li> -->
    <li><a href="/gems/representable/3.0/xml.html">XML</a></li>
    <li><a href="/gems/representable/3.0/yaml.html">YAML</a></li>
    <li><a href="/gems/representable/upgrading-guide.html">Upgrading Guide</a></li>
    <li class="divider"></li>

    <li class="heading">
        <a href="/gems/roar">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> ROAR
        </a>
    </li>
    <li><a href="/gems/roar/jsonapi.html">JSON API</a></li>
    <li class="divider"></li>

    <li class="heading">
        <a href="/gems/disposable">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> DISPOSABLE
        </a>
    </li>
    <li><a href="/gems/disposable/api.html">API</a></li>
    <li><a href="/gems/disposable/default.html">Default</a></li>
    <li><a href="/gems/disposable/callback.html">Callback</a></li>
    <li class="divider"></li>

    <li class="heading">
        <a href="/guides">
            <i class="fa fa-caret-square-o-right" aria-hidden="true"></i> GUIDES
        </a>
    </li>
    <li><a href="/guides/trailblazer-in-20-minutes.html">Trailblazer In 20 Minutes</a></li>
    <li><a href="/guides/getting-started.html">Getting Started</a></li>
    <li><a href="/guides/sinatra/getting-started.html">Sinatra</a></li>
    <li><a href="/guides/grape.html">Grape</a></li>
  </ul>
</nav>

      </div>
      <div class="columns medium-9 code-content">
        <h1 id="prepopulating">Prepopulating</h1>

<p>Reform has two completely separated modes for form setup. One when rendering the form and one when populating the form in <code>validate</code>.</p>

<p><a href="/gems/reform/prepopulator.html">Prepopulating</a> is helpful when you want to fill out fields (aka. <em>defaults</em>) or add nested forms before rendering.</p>

<p><a href="/gems/reform/populators.html">Populating</a> is invoked in <code>validate</code> and will add nested forms depending on the incoming hash.</p>

<p>This page explains prepopulation used to prepare the form for rendering.</p>

<h2 id="configuration">Configuration</h2>

<p>You can use the <code>:prepopulator</code> option on every property or collection.</p>

<pre><code>class AlbumForm &lt; Reform::Form
  property :artist, prepopulator: -&gt;(options) { self.artist = Artist.new } do
    property :name
  end
</code></pre>

<p>The option value can be a lambda or an instance method name.</p>

<p>In the block/method, you have access to the form API and can invoke any kind of logic to prepopulate your form. Note you need to assign models for nested form using their writers.</p>

<h2 id="invocation">Invocation</h2>

<p>Prepopulation must be invoked manually.</p>

<pre><code>form = AlbumForm.new(Album.new)
form.artist #=&gt; nil

form.prepopulate!

form.artist #=&gt; &lt;nested ArtistForm @model=&lt;Artist ..&gt;&gt;
</code></pre>

<p>This explicit call must happen before the form gets rendered. For instance, in Trailblazer, this happens in the controller action.</p>

<h2 id="prepopulate-is-not-populate">Prepopulate is not Populate</h2>

<p><code>:populator</code> and <code>:populate_if_empty</code> will be run automatically in <code>validate</code>. Do not call <code>prepopulate!</code> before <code>validate</code> if you use the populator options. This will usually result in “more” nested forms being added as you wanted (unless you know what you’re doing).</p>

<p>Prepopulators are a concept designed to <strong>prepare a form for rendering</strong>, whereas populators are meant to <strong>set up the form in <code>validate</code></strong> when the input hash is deserialized.</p>

<p>This is explained in the <em>Nested Forms</em> chapter of the Trailblazer book. Please read it first if you have trouble understanding this, and then open an issue.</p>

<h2 id="options">Options</h2>

<p>Options may be passed. They will be available in the <code>:prepopulator</code> block.</p>

<pre><code>class AlbumForm &lt; Reform::Form
  property :title, prepopulator: -&gt;(options) { self.title = options[:def_title] }
end
</code></pre>

<p>You can then pass arbitrary arguments to <code>prepopulate!</code>.</p>

<pre><code>form.title #=&gt; nil

form.prepopulate!(def_title: "Roxanne")

form.title #=&gt; "Roxanne"
</code></pre>

<p>The arguments passed to the <code>prepopulate!</code> call will be passed straight to the block/method.</p>

<p>This call will be applied to the entire nested form graph recursively <em>after</em> the currently traversed form’s prepopulators were run.</p>

<h2 id="execution">Execution</h2>

<p>The blocks are run in form instance context, meaning you have access to all possible data you might need. With a symbol, the same-named method will be called on the form instance, too.</p>

<p>Note that you have to assign the pre-populated values to the form by using setters. In turn, the form will automatically create nested forms for you.</p>

<p>This is especially cool when populating collections.</p>

<pre><code>property :songs,
  prepopulator: -&gt;(*) { self.songs &lt;&lt; Song.new if songs.size &lt; 3 } do
</code></pre>

<p>This will always add an empty song form to the nested <code>songs</code> collection until three songs are attached. You can use the <code>Twin::Collection</code> <a href="/gems/disposable/collection.html">API</a> when adding, changing or deleting items from a collection.</p>

<p>Note that when calling <code>#prepopulate!</code>, your <code>:prepopulate</code> code for all existing forms in the graph will <em>be executed</em> . It is up to you to add checks if you need that.</p>

<h2 id="overriding">Overriding</h2>

<p>You don’t have to use the <code>:prepopulator</code> option. Instead, you can simply override <code>#prepopulate!</code> itself.</p>

<pre><code>class AlbumForm &lt; Reform::Form
  def prepopulate!(options)
    self.title = "Roxanne"
    self.artist = Artist.new(name: "The Police")
  end
</code></pre>

<h1 id="defaults">Defaults</h1>

<p>There’s different alternatives for setting a default value for a formerly empty field.</p>

<ol>
  <li>Use <code>:prepopulator</code> as <a href="#configuration">described here</a>. Don’t forget to call <code>prepopulate!</code> before rendering the form.</li>
  <li>
    <p>Override the reader of the property. This is not recommended as you might screw things up. Remember that the property reader is called for presentation (in the form builder) and for validation in <code>#validate</code>.</p>

    <pre><code>property :title

def title
  super or "Unnamed"
end
</code></pre>
  </li>
</ol>

      </div>
    </div>

    <!-- Footer -->
<section class="sub-section top-footer">
  <div class="row">
	<div class="columns medium-6">
		<h3>Newsletter</h3>
		<p>
			Stay on top of what’s happening in Trailblazer.
		</p>
			<div class="row">
				<div id="mc_embed_signup">
		     	<form action="//trailblazerb.us8.list-manage.com/subscribe/post?u=bbe5021ab6fbdc94a16f0d036&amp;id=a69f6e4652" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>

						<div class="columns large-9 medium-12 ">
							<div class="row collapse prefix-radius">
				        <div class="small-8 medium-7 large-8 columns">
				        	<div id="mc_embed_signup_scroll">
				        		<div class="mc-field-group">
									  	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="youremail@trailblazer.to">
									  </div>
									  <div id="mce-responses" class="clear">
									    <div class="response" id="mce-error-response" style="display:none"></div>
									    <div class="response" id="mce-success-response" style="display:none"></div>
									  </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
									  <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_bbe5021ab6fbdc94a16f0d036_a69f6e4652" tabindex="-1" value=""></div>

				        	</div>
				        </div>
				        <div class="small-4 medium-5 large-4 columns">
				          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button postfix secondary">
				        </div>
				      </div>
						</div>
					</form>
				</div>
				<script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
			</div>
		<p>
			And check out the <a href="/newsletter/">archive of newsletters</a>!
		</p>


	</div>
	<div class="columns medium-6">
		<h3>The Book</h3>
		<p>Learn how to built a Rails app with Trailblazer, step-by-step.</p>
		<a href="/books/trailblazer.html" class="button radius tiny secondary">Check Out Book!</a>
	</div>
</div>


</section>

<footer>
  <div class="row">
    <div class="columns medium-4">
      <div class="logo-box">
        <a href="/"><img src="/images/icon_trb.png">
        </a>
      </div>
    </div>
    <div class="columns medium-8">
      <div class="row">
        <div class="columns medium-6">
          <h4>
            Trailblazer
          </h4>
          <ul class="no-bullet">
            <li><a href="https://gitter.im/trailblazer/chat">Gitter chat</a></li>
            <li><a href="https://leanpub.com/trailblazer">The book</a></li>
          </ul>
        </div>
        <div class="columns medium-6">
          <h4>
            Follow Us
          </h4>
          <ul class="inline-list">
            <li>
              <a href="https://github.com/trailblazer">
                <i class="footer-icon github-icon"></i>
              </a>
            </li>
            <li>
              <a href="https://twitter.com/apotonick">
                <i class="footer-icon twitter-icon"></i>
              </a>
            </li>
            <li>
              <a href="https://facebook.com/trbinc">
                <i class="footer-icon facebook-icon"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <p class="copyright">
        Trailblazer is created by <a href="https://github.com/apotonick">Nick Sutterer</a> and awesome friends.
      </p>
      <p class="copyright">
        Site designed and handcoded with love by <a href="https://twitter.com/noeliacabane">Noelia Cabane</a>
      </p>
    </div>
  </div>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69514939-1', 'auto');
  ga('send', 'pageview');

</script>


<script type="text/javascript">
$( ".tabs" ).tabs({
  active: 1
});
$(".tabs").removeClass("ui-widget");

</script>

  </body>
</html>
