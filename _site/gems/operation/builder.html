<!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> - </title>
    <meta name="description" content=" - " />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="keywords" content=", " />

    <!-- CSS  Get: http://www.google.com/fonts/
    http://stackoverflow.com/questions/7985081/how-to-deploy-a-jekyll-site-locally-with-css-js-and-background-images-included
    ================================================== -->
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400,700,800|Raleway:400,200,700" rel="stylesheet" type="text/css">
    <!-- Fount Awesome -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="stylesheet" href="css/style.css" />
    <link rel="shortcut icon" href="favicon.ico">
    <meta property="og:title" content=""/>
    <meta property="og:site_name" content=" - "/>
    <meta property="og:url" content=" - "/>
    <meta property="og:description" content=""/>
    <meta property="og:image" content=""/>
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">
    <script src="bower_components/modernizr/modernizr.js"></script>
  </head>

  <body>
    <!-- Top Bar -->
    <nav class="top-bar" data-topbar role="navigation">
  <ul class="title-area">
    <li class="name">
      <h1><a href="#">Trailblazer</a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
  </ul>

  <section class="top-bar-section">
    <ul class="right">
      <li class="active"><a href="#">Right Button Active</a></li>
    </ul>
  </section>
</nav>


    <!-- Hero -->
    <div class="hero">
  <div class="hero-unit">
    <div class="row">
      <div class="columns">
        <h1 id="project_title">
          <!-- <a href="#"><img src="/images/icon_trb.png">
          </a> -->
          Trailblazer
        </h1>
        <h2>A new architecture for Rails</h2>
      </div>
    </div>
  </div>
</div>



    <div class="row">
      <div class="columns large-3">
        <!--    <a href="https://github.com/trailblazer/www.trailblazerb.org" class="button">View on GitHub</a>
        <a class="button" href="https://github.com/trailblazer/www.trailblazerb.org/zipball/master">Download this project as a .zip file</a>
        <a class="button" href="https://github.com/trailblazer/www.trailblazerb.org/tarball/master">Download this project as a tar.gz file</a> -->

<ul class="side-nav">
  <li><a href="#">Link 1</a></li>
  <li><a href="#">Link 2</a></li>
  <li><a href="#">Link 3</a></li>
  <li><a href="#">Link 4</a></li>
</ul>

      </div>
      <div class="columns medium-9">
        <h1 id="builder">Builder</h1>

<p>Different contexts like <em>“admin user”</em> vs. <em>“signed in”</em> can be handled in the same code asset along with countless <code>if</code>s and <code>else</code>s. Or, you can use polymorphism as it is encouraged by Trailblazer.</p>

<p>The easiest way is to use normal inheritance for context-specific operations.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Thing</span><span class="o">::</span><span class="no">Create</span> <span class="o">&lt;</span> <span class="no">Trailblazer</span><span class="o">::</span><span class="no">Operation</span>
  <span class="c1"># generic code, contracts, etc.</span>

  <span class="k">class</span> <span class="nc">SignedIn</span> <span class="o">&lt;</span> <span class="nb">self</span>
    <span class="c1"># specific code</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>A <code>builds</code> block allows to let the operation class take care of the instantiation process.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Thing</span><span class="o">::</span><span class="no">Create</span> <span class="o">&lt;</span> <span class="no">Trailblazer</span><span class="o">::</span><span class="no">Operation</span>
  <span class="n">builds</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">return</span> <span class="no">SignedIn</span> <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:current_user</span><span class="o">]</span>
  <span class="k">end</span></code></pre></div>

<p>When running the top-level operation, the builder will instantiate the correct subclass according to the <code>params</code> environment.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">op</span> <span class="o">=</span> <span class="no">Thing</span><span class="o">::</span><span class="no">Create</span><span class="o">.</span><span class="p">(</span><span class="ss">current_user</span><span class="p">:</span> <span class="n">admin</span><span class="p">)</span>
<span class="n">op</span><span class="o">.</span><span class="n">class</span> <span class="c1">#=&gt; Thing::Create::SignedIn</span></code></pre></div>

<p>If the <code>builds</code> block doesn’t return a constant, the original constant will be used for instantiation. In our example, this would resolve to <code>Thing::Create</code>.</p>

<h2 id="shared-builders">Shared Builders</h2>

<p><code>builds</code> blocks are <em>not inherited</em>. You can copy them to other classes, though.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Thing</span><span class="o">::</span><span class="no">Update</span> <span class="o">&lt;</span> <span class="no">Trailblazer</span><span class="o">::</span><span class="no">Operation</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">builds_class</span> <span class="o">=</span> <span class="no">Create</span><span class="o">.</span><span class="n">build_class</span></code></pre></div>

<p>Be careful about constant resolving here: the block you copied has to have runtime evaluation of constants.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Thing</span><span class="o">::</span><span class="no">Create</span> <span class="o">&lt;</span> <span class="no">Trailblazer</span><span class="o">::</span><span class="no">Operation</span>
  <span class="n">builds</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">return</span> <span class="nb">self</span><span class="o">::</span><span class="no">SignedIn</span> <span class="k">if</span> <span class="c1"># ...</span>
  <span class="k">end</span></code></pre></div>

<p>Now, the block can safely be copied to other classes where <code>SignedIn</code> will be resolved in the new context.</p>

<h2 id="resolver">Resolver</h2>

<p>A resolver allows you to use both the operation model and the policy in the builder.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Thing</span><span class="o">::</span><span class="no">Create</span> <span class="o">&lt;</span> <span class="no">Trailblazer</span><span class="o">::</span><span class="no">Operation</span>
  <span class="kp">include</span> <span class="no">Resolver</span>

  <span class="n">policy</span> <span class="no">Thing</span><span class="o">::</span><span class="no">Policy</span><span class="p">,</span> <span class="ss">:create?</span>
  <span class="n">model</span> <span class="no">Thing</span><span class="p">,</span> <span class="ss">:create</span>

  <span class="n">builds</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">policy</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="k">return</span> <span class="no">Admin</span> <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">admin?</span>
    <span class="k">return</span> <span class="no">SignedIn</span> <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:current_user</span><span class="o">]</span>
  <span class="k">end</span></code></pre></div>

<p>Please note that the <code>builds</code> block is run in class context, no operation instance is available, yet. It is important to understand that <code>Resolver</code> also changes the way the operation’s model is created/found. This, too, happens on the class layer, now.</p>

<p>You have to configure the CRUD module using <code>::model</code> so the operation can instantiate the correct model for the builder.</p>

<p>If you want to change the way the model is created, you have to do so on the class level.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Thing</span><span class="o">::</span><span class="no">Create</span> <span class="o">&lt;</span> <span class="no">Trailblazer</span><span class="o">::</span><span class="no">Operation</span>
  <span class="kp">include</span> <span class="no">Resolver</span>
  <span class="c1"># ..</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">model!</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="no">Thing</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">slug</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:slug</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span></code></pre></div>

<p>Do <em>not</em> include <code>CRUD</code> when using <code>Resolver</code>.</p>

      </div>
    </div>

    <!-- The Book -->
    <div class="row">
      <div class="columns">
        <h2>The Book</h2>
<div class="row">
  <div class="columns medium-3">
    <a href="https://leanpub.com/trailblazer">
    <img src="images/3dbuch-freigestellt.png" />
    </a>
  </div>

  <div class="columns medium-9">
    <p>Yes, there's a book!</p>
    <p>Written by the busy creator of Trailblazer, it is about 70% finished and will get another 150 pages, making it 300 pages full of wisdom about Trailblazer and all the gems.</p>

    <p>If you want to learn about this project and if you feel like supporting Open-Source, please <a href="https://leanpub.com/trailblazer">buy and read it</a> and let us know what you think.</p>
  </div>
</div>

      </div>
    </div>


    <!-- Testimonials -->
    <div class="row">
      <div class="columns">
        <h2>
  Testimonials
</h2>

<blockquote>
  At some point of time we started to decouple our form objects from models. Things got a lot easier when we found out there is a ready to use solution which solves our exact problem. That was Reform. Soon after, we started using all other parts of Trailblazer and haven't regretted a second of our time we spent using it.
  <cite>Igor Pstyga, Shop Hers Inc</cite>
</blockquote>

<blockquote>
  Here at Chefsclub, we are very happy with Trailblazer. Our application already has 32 concepts, 130+ operations, and Cells surprised us as an awesome feature. We feel pretty safe with it.
  <cite>Paulo Fabiano Langer, Chefsclub</cite>
</blockquote>

<blockquote>
  Trailblazer helps organize my code, the book showed me how. You can assume what each component does by its name, it's very easy and intuitive, it should be shipped as an essential part of Rails.
  <cite>Yuri Freire Lima, AzClick</cite>
</blockquote>

      </div>
    </div>


    <!-- Footer -->
    <footer>
  <div class="row">
    <div class="columns">
      <p>Trailblazer maintained by <a href="https://github.com/trailblazer">trailblazer</a></p>
    </div>
  </div>
</footer>




    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="bower_components/jquery/jquery.js"><\/script>')</script>
    <script src="js/plugins.js"></script>
    <script src="bower_components/foundation/js/foundation.min.js"></script>
    <script src="js/script.js"></script>

  </body>
</html>
