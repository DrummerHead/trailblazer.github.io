<!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> - </title>
    <meta name="description" content=" - " />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="keywords" content=", " />

    <!-- CSS  Get: http://www.google.com/fonts/
    http://stackoverflow.com/questions/7985081/how-to-deploy-a-jekyll-site-locally-with-css-js-and-background-images-included
    ================================================== -->
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400,700,800|Raleway:400,200,700" rel="stylesheet" type="text/css">
    <!-- Fount Awesome -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="stylesheet" href="css/style.css" />

    <!-- Ah, the favicon.
    ================================================== -->
    <link rel="shortcut icon" href="favicon.ico">

    <!-- Open Graph: https://developers.facebook.com/docs/opengraph/howtos/maximizing-distribution-media-content/
    Twitter: https://dev.twitter.com/docs/cards/types/summary-card
    ============================== -->
    <meta property="og:title" content=""/>
    <meta property="og:site_name" content=" - "/>
    <meta property="og:url" content=" - "/>
    <meta property="og:description" content=""/>
    <meta property="og:image" content=""/>
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- modernizr
    ================================================== -->
    <script src="bower_components/modernizr/modernizr.js"></script>
  </head>
  <body>
    <nav class="top-bar" data-topbar role="navigation">
  <ul class="title-area">
    <li class="name">
      <h1><a href="#">My Site</a></h1>
    </li>
     <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
    <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
  </ul>

  <section class="top-bar-section">
    <!-- Right Nav Section -->
    <ul class="right">
      <li class="active"><a href="#">Right Button Active</a></li>
      <li class="has-dropdown">
        <a href="#">Right Button Dropdown</a>
        <ul class="dropdown">
          <li><a href="#">First link in dropdown</a></li>
          <li class="active"><a href="#">Active link in dropdown</a></li>
        </ul>
      </li>
    </ul>

    <!-- Left Nav Section -->
    <ul class="left">
      <li><a href="#">Left Nav Button</a></li>
    </ul>
  </section>
</nav>


    <!-- Hero -->
    <div class="hero">
      <div class="hero-unit">
        <div class="row">
          <div class="columns">
            <h1 id="project_title">
              <a href="#"><img src="/images/icon_trb_glow.png"></a>

              Trailblazer
            </h1>
            <h2>A new architecture for Rails</h2>

          </div>
        </div>
      </div>
    </div>


    <div class="row">
      <div class="columns large-3">
     <!--    <a href="https://github.com/trailblazer/www.trailblazerb.org" class="button">View on GitHub</a>
        <a class="button" href="https://github.com/trailblazer/www.trailblazerb.org/zipball/master">Download this project as a .zip file</a>
        <a class="button" href="https://github.com/trailblazer/www.trailblazerb.org/tarball/master">Download this project as a tar.gz file</a> -->

        <h5>Sidebar</h5>
        <ul class="side-nav">
          <li><a href="#">Link 1</a></li>
          <li><a href="#">Link 2</a></li>
          <li><a href="#">Link 3</a></li>
          <li><a href="#">Link 4</a></li>
        </ul>

      </div>
      <div class="columns medium-9">
        <h1 id="operationcontroller">Operation::Controller</h1>

<p>The <code>Operation::Controller</code> module provides four shorthand methods to run and present operations. It works in Rails but should also be fine in Sinatra.</p>

<h2 id="generics">Generics</h2>

<p>Before the operation is invoked, the controller method <code>process_params!</code> is run. You can override that to normalize the incoming parameters.</p>

<p>Each method will set the <code>@operation</code> and <code>@model</code> instance variables on the controller which allows using them in views, too. Each method returns the operation instance.</p>

<p>You need to include the <code>Controller</code> module.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">include</span> <span class="no">Trailblazer</span><span class="o">::</span><span class="no">Operation</span><span class="o">::</span><span class="no">Controller</span>
<span class="k">end</span></code></pre></div>

<h2 id="run">Run</h2>

<p>Use <code>#run</code> to invoke the operation.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="n">run</span> <span class="no">Comment</span><span class="o">::</span><span class="no">Create</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Internally, this will do as follows.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">process_params!</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="n">result</span><span class="p">,</span> <span class="n">op</span> <span class="o">=</span> <span class="no">Comment</span><span class="o">::</span><span class="no">Create</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="vi">@operation</span> <span class="o">=</span> <span class="n">op</span>
<span class="vi">@model</span>     <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">model</span>
<span class="vi">@form</span>      <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">contract</span></code></pre></div>

<p>First, you have the chance to normalize parameters. The controller’s <code>params</code> hash is then passed into the operation run. After that, the three instance variables on the controller are set, giving you access to operation instance, form and model.</p>

<p>An optional block for <code>#run</code> is invoked only when the operation was valid.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="n">run</span> <span class="no">Comment</span><span class="o">::</span><span class="no">Create</span> <span class="k">do</span> <span class="o">|</span><span class="n">op</span><span class="o">|</span>
      <span class="n">flash</span><span class="o">[</span><span class="ss">:notice</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Success!&quot;</span> <span class="c1"># only run for successful/valid operation.</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<h2 id="present">Present</h2>

<p>To setup an operation without running its <code>#process</code> method, use <code>#present</code>. This is often used if you only need the operation’s model for presentation.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="n">present</span> <span class="no">Comment</span><span class="o">::</span><span class="no">Update</span>
    <span class="c1"># you have access to @operation and @model.</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Instead of running the operation, this will only instantiate the operation by passing in the controller’s <code>params</code>. In turn, this only runs the operation’s <code>#setup</code> (which embraces model finding logic) and does <strong>not instantiate</strong> a contract and <strong>doesn’t run</strong> <code>#process</code>.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Comment</span><span class="o">::</span><span class="no">Update</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="vi">@operation</span> <span class="o">=</span> <span class="n">op</span>
<span class="vi">@model</span>     <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">model</span></code></pre></div>

<h2 id="form">Form</h2>

<p>To render the operation’s form, use <code>#form</code>.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="n">form</span> <span class="no">Comment</span><span class="o">::</span><span class="no">Create</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>This is identical to <code>#present</code> with two additional step: besides the <code>@operation</code> and <code>@model</code> instance variables, the <code>@form</code> will be assigned, too. After that, the form’s <code>prepopulate!</code> method is called and the form is ready for rendering, e.g. via <code>#form_for</code>.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">op</span> <span class="o">=</span> <span class="no">Comment</span><span class="o">::</span><span class="no">Create</span><span class="o">.</span><span class="n">present</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">op</span><span class="o">.</span><span class="n">contract</span><span class="o">.</span><span class="n">prepopulate!</span>
<span class="vi">@operation</span> <span class="o">=</span> <span class="n">op</span>
<span class="vi">@model</span>     <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">model</span>
<span class="vi">@form</span>      <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">contract</span></code></pre></div>

<h2 id="respond">Respond</h2>

<p>Rails-specific.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">respond_to</span> <span class="ss">:json</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="n">respond</span> <span class="no">Comment</span><span class="o">::</span><span class="no">Create</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>This will do the same as <code>#run</code>, invoke the operation and then pass it to <code>#respond_with</code>.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">op</span> <span class="o">=</span> <span class="no">Comment</span><span class="o">::</span><span class="no">Create</span><span class="o">.</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">respond_with</span> <span class="n">op</span></code></pre></div>

<p>The operation needs to be prepared for the responder as the latter makes weird assumptions about the object being passed to <code>respond_with</code>. For example, the operation needs to respond to <code>to_json</code> in a JSON request. Read about <a href="representer.html">Representer</a> here.</p>

<p>In a non-HTML request (e.g. for <code>application/json</code>) the params hash will be slightly modified. As the operation’s model key, the request body document is passed into the operation.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">params</span><span class="o">[</span><span class="ss">:comment</span><span class="o">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span>
<span class="no">Comment</span><span class="o">::</span><span class="no">Create</span><span class="o">.</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code></pre></div>

<p>By doing so the operation’s representer will automatically parse and deserialize the incoming document, bypassing Rails’ <code>ParamsParser</code>.</p>

<p>If you want the responder to compute URLs with namespaces, pass in the <code>:namespace</code> option.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">respond</span> <span class="no">Comment</span><span class="o">::</span><span class="no">Create</span><span class="p">,</span> <span class="ss">namespace</span><span class="p">:</span> <span class="o">[</span><span class="ss">:api</span><span class="o">]</span></code></pre></div>

<p>This will result in a call <code>respond_with :api, op</code>.</p>

<h2 id="normalizing-params">Normalizing Params</h2>

<p>Override #process_params! to add or remove values to params before the operation is run. This is called in #run, #respond and #present and #form.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="kp">private</span>
  <span class="k">def</span> <span class="nf">process_params!</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">params</span><span class="o">.</span><span class="n">merge!</span><span class="p">(</span><span class="ss">current_user</span><span class="p">:</span> <span class="n">current_user</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>This centralizes params normalization and doesn’t require you to do that in every action manually.</p>

      </div>
    </div>

    <!-- FOOTER  -->
    <footer>
      <div class="row">
        <div class="columns">
          <p>Trailblazer maintained by <a href="https://github.com/trailblazer">trailblazer</a></p>
        </div>
      </div>
    </footer>


    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="bower_components/jquery/jquery.js"><\/script>')</script>
    <script src="js/plugins.js"></script>
    <script src="bower_components/foundation/js/foundation.min.js"></script>
    <script src="js/script.js"></script>

  </body>
</html>
