<!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> - </title>
    <meta name="description" content=" - " />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="keywords" content=", " />

    <!-- CSS  Get: http://www.google.com/fonts/
    http://stackoverflow.com/questions/7985081/how-to-deploy-a-jekyll-site-locally-with-css-js-and-background-images-included
    ================================================== -->
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400,700,800|Raleway:400,200,700" rel="stylesheet" type="text/css">
    <!-- Fount Awesome -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="stylesheet" href="css/style.css" />
    <link rel="shortcut icon" href="favicon.ico">
    <meta property="og:title" content=""/>
    <meta property="og:site_name" content=" - "/>
    <meta property="og:url" content=" - "/>
    <meta property="og:description" content=""/>
    <meta property="og:image" content=""/>
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">
    <script src="bower_components/modernizr/modernizr.js"></script>
  </head>

  <body>
    <!-- Top Bar -->
    <nav class="top-bar" data-topbar role="navigation">
  <ul class="title-area">
    <li class="name">
      <h1><a href="#">Trailblazer</a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
  </ul>

  <section class="top-bar-section">
    <ul class="right">
      <li class="active"><a href="#">Right Button Active</a></li>
    </ul>
  </section>
</nav>


    <!-- Hero -->
    <div class="hero">
  <div class="hero-unit">
    <div class="row">
      <div class="columns">
        <h1 id="project_title">
          <!-- <a href="#"><img src="/images/icon_trb.png">
          </a> -->
          Trailblazer
        </h1>
        <h2>A new architecture for Rails</h2>
      </div>
    </div>
  </div>
</div>



    <div class="row">
      <div class="columns large-3">
        <!--    <a href="https://github.com/trailblazer/www.trailblazerb.org" class="button">View on GitHub</a>
        <a class="button" href="https://github.com/trailblazer/www.trailblazerb.org/zipball/master">Download this project as a .zip file</a>
        <a class="button" href="https://github.com/trailblazer/www.trailblazerb.org/tarball/master">Download this project as a tar.gz file</a> -->

<ul class="side-nav">
  <li><a href="#">Link 1</a></li>
  <li><a href="#">Link 2</a></li>
  <li><a href="#">Link 3</a></li>
  <li><a href="#">Link 4</a></li>
</ul>

      </div>
      <div class="columns medium-9">
        <h1 id="policy">Policy</h1>

<p>Trailblazer supports “pundit-style” policy classes. They can be hooked into operations and prevent the operation from running its <code>#process</code> method by raising an exception if the policy rule returned <code>false</code>.</p>

<h2 id="policy-classes">Policy Classes</h2>

<p>The format of a policy class is heavily inspired by the excellent <a href="https://github.com/elabs/pundit">Pundit</a> gem. In fact, you can reuse your pundit policies without any code changes in Trailblazer.</p>

<p>A policy file per concept is recommendable.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Thing</span><span class="o">::</span><span class="no">Policy</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">thing</span><span class="p">)</span>
    <span class="vi">@user</span><span class="p">,</span> <span class="vi">@thing</span> <span class="o">=</span> <span class="n">user</span><span class="p">,</span> <span class="n">thing</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create?</span>
    <span class="n">admin?</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">admin?</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">admin</span> <span class="o">==</span> <span class="kp">true</span>
  <span class="k">end</span>
  <span class="c1"># ..</span>
<span class="k">end</span></code></pre></div>

<p>This class would probably be best located at <code>app/concepts/thing/policy.rb</code>.</p>

<h2 id="operation-policy">Operation Policy</h2>

<p>Use <code>::policy</code> to hook the policy class along with a query action into your operation.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Thing</span><span class="o">::</span><span class="no">Create</span> <span class="o">&lt;</span> <span class="no">Trailblazer</span><span class="o">::</span><span class="no">Operation</span>
  <span class="kp">include</span> <span class="no">Policy</span>

  <span class="n">policy</span> <span class="no">Thing</span><span class="o">::</span><span class="no">Policy</span><span class="p">,</span> <span class="ss">:create?</span></code></pre></div>

<p>The policy is evaluated in <code>#setup!</code>, raises an exception if <code>false</code> and thus suppresses running <code>#process</code>. It is a great way to protect your operations from unauthorized users.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Thing</span><span class="o">::</span><span class="no">Create</span><span class="o">.</span><span class="p">(</span><span class="ss">current_user</span><span class="p">:</span> <span class="no">User</span><span class="o">.</span><span class="n">find_normal_user</span><span class="p">,</span> <span class="ss">thing</span><span class="p">:</span> <span class="p">{})</span></code></pre></div>

<p>This will raise a <code>Trailblazer::NotAuthorizedError</code>.</p>

<h2 id="policy-creation">Policy Creation</h2>

<p>To instantiate the <code>Thing::Policy</code> object internally, per default the <code>params[:current_user]</code> and the operation’s <code>model</code> is passed into the constructor. You can override that via <code>Operation#evaluate_policy</code>.</p>

<h2 id="queries">Queries</h2>

<p>After <code>#setup!</code>, the policy instance is available at any point in your operation code.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
  <span class="n">notify_admin!</span> <span class="k">if</span> <span class="n">policy</span><span class="o">.</span><span class="n">admin?</span></code></pre></div>

<p>This won’t raise an exception.</p>

<h2 id="pundit">Pundit</h2>

<p>Pundit policy classes can be used directly in operations.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Thing</span><span class="o">::</span><span class="no">Create</span> <span class="o">&lt;</span> <span class="no">Trailblazer</span><span class="o">::</span><span class="no">Operation</span>
  <span class="kp">include</span> <span class="no">Policy</span>
  <span class="n">policy</span> <span class="no">ThingPolicy</span><span class="p">,</span> <span class="ss">:create?</span></code></pre></div>

<p>As a matter of course, you may call other rule queries on the internal policy object later on.</p>

<h2 id="guard">Guard</h2>

<p>Instead of using policies, you can also use a simple guard. A guard is like an inline policy that doesn’t require you to define a policy class. It is run in <code>#setup!</code>, too, like a real policy, but isn’t accessable in the operation after that.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Thing</span><span class="o">::</span><span class="no">Create</span> <span class="o">&lt;</span> <span class="no">Trailblazer</span><span class="o">::</span><span class="no">Operation</span>
  <span class="kp">include</span> <span class="no">Policy</span><span class="o">::</span><span class="no">Guard</span>

  <span class="n">policy</span><span class="o">-&gt;</span> <span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">return</span> <span class="kp">false</span> <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:current_user</span><span class="o">].</span><span class="n">nil?</span>
  <span class="k">end</span></code></pre></div>

<p>Note that you can’t mix <code>Policy</code> and guards in one class.</p>

<h2 id="resolver">Resolver</h2>

<p>You can use policies in your builders, too. Please refer to the <a href="builder.html#resolver">builder docs</a> to learn about that.</p>

      </div>
    </div>

    <!-- The Book -->
    <div class="row">
      <div class="columns">
        <h2>The Book</h2>
<div class="row">
  <div class="columns medium-3">
    <a href="https://leanpub.com/trailblazer">
    <img src="images/3dbuch-freigestellt.png" />
    </a>
  </div>

  <div class="columns medium-9">
    <p>Yes, there's a book!</p>
    <p>Written by the busy creator of Trailblazer, it is about 70% finished and will get another 150 pages, making it 300 pages full of wisdom about Trailblazer and all the gems.</p>

    <p>If you want to learn about this project and if you feel like supporting Open-Source, please <a href="https://leanpub.com/trailblazer">buy and read it</a> and let us know what you think.</p>
  </div>
</div>

      </div>
    </div>


    <!-- Testimonials -->
    <div class="row">
      <div class="columns">
        <h2>
  Testimonials
</h2>

<blockquote>
  At some point of time we started to decouple our form objects from models. Things got a lot easier when we found out there is a ready to use solution which solves our exact problem. That was Reform. Soon after, we started using all other parts of Trailblazer and haven't regretted a second of our time we spent using it.
  <cite>Igor Pstyga, Shop Hers Inc</cite>
</blockquote>

<blockquote>
  Here at Chefsclub, we are very happy with Trailblazer. Our application already has 32 concepts, 130+ operations, and Cells surprised us as an awesome feature. We feel pretty safe with it.
  <cite>Paulo Fabiano Langer, Chefsclub</cite>
</blockquote>

<blockquote>
  Trailblazer helps organize my code, the book showed me how. You can assume what each component does by its name, it's very easy and intuitive, it should be shipped as an essential part of Rails.
  <cite>Yuri Freire Lima, AzClick</cite>
</blockquote>

      </div>
    </div>


    <!-- Footer -->
    <footer>
  <div class="row">
    <div class="columns">
      <p>Trailblazer maintained by <a href="https://github.com/trailblazer">trailblazer</a></p>
    </div>
  </div>
</footer>




    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="bower_components/jquery/jquery.js"><\/script>')</script>
    <script src="js/plugins.js"></script>
    <script src="bower_components/foundation/js/foundation.min.js"></script>
    <script src="js/script.js"></script>

  </body>
</html>
